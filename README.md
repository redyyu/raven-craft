# Raven Craft

A Project zomboid mod. expanding vanilla constructable facilities and craftable items.
Everything in this mod is try keep "Reasonable" and "Useable", make the game as close to reality as possible, but keep not too much complicated details.

Some idea is from other mods, make it more fit with vanilla game. 
Also, I did learn so much from many other mods, 
those knowledge is become my treasure, Thank you very much.



## Vanilla Expanding

1. Metal Drum only need 2 Log to burn.
2. Snow can be collect by rain barrel or metal drum as water. count 10:1(wanter)
3. Add Simple Pad shield for elbow, knee and shoulder. Some zombies will wearing it as well.
4. Maintance skill could help fixing.
5. Change some clothes textures.
6. Change multiple tools to open canned food. ex. knife and fork.
7. Bombs cloud spawn in some place.
8. Some tools hidden by vanilla, make it useful and spawn in some wheere. ex. ammo mold, tongs, Bellows...
9. Reading speed up while sit on ground.
10. Allowed suicide by gun.
11. Katana and Machete allowed attach on belt.
12. Move up / down or jump to ground, when climbing rope.
13. Increase Red Mobile Tool Cabinet capacity. (only effect new discovered.)
14. Combine better boots 3D model and textures.
15. 5 x Armor Pads for different positions.
16. Backpacks and HikingBags have attachments by default. (no need Tailoring it any more.)
17. Add Canteen, Flashlight and ChestRig. (No nead G.E.A.R)
18. New Skill Books for weapons.



### Added new Carpentry Expands:

1. **Outhouse Door**: a different looking wooden door.
2. **Fence Gate**: door for lower fence, dont'need door frame.
3. **High Fence Gate**: door for high fence or wooden wall, dont'need door frame.
4. **Dog House**: For my dog, but no dog in this mod yet.
5. **Concrete Floor**: looks same as garage floor in RiverSide house. use to cover the floor when you need expanding your garage. (you have to make bucket of concrete frist, which is added by new recipe.)

*no magazine required above*


### Added new Metalworking Expands:
1. **Metal Door**: a gray metal door, just like the one usual find in the game. ex. Gigamart.
2. **Rolling Garage Door**: a kind of Garage Door, x3 tiles and sliver. Incase zombies crash your garage door. 
3. **Warehouse Floor**: like the metal grate floor in any Warehouse. incase you want make second floor in warehouse.
4. **Harder Warehouse Floor**: Metal grate floor with side bar.
4. **Warehouse Handrail**: Metal handrail in any Warehouse.
5. **Metal Drum**: Metal Drum can collect rain water or burn Log to Charcoal, Same as those Drum outside in Louisville. now, we can build this with any Metal Barrel. (also need `WeldingMask`, `WeldingRods`, and `BlowTorch`)

*"Metal Door" and "Rolling Garage Door" required "Make Metal Fences" recipe.*
*"Warehouse Floor" and "Harder Warehouse Floor" required "Make Metal Roof" recipe.*
*"Warehouse Handrail" required "Make Metal Fences" recipe.*
*"Metal Drum" required "Make Metal Containers" recipe.*
*Those recipes is in vanilla metalworking magazine.*


### Added new Workbench for Metalworking:
1. **Stone Furnace**: Smelting metal products to workable ingot. which is hidden by vanilla, I bring it out, also the bug while "Put out fire" and fired texture not display is fixed.
2. **Anvil**: Used in forging various metal objects, such as Aex, Shovel. not every metal have to near Anvil to make.

*Required "Craft Workbench" recipe, which is in "The Spirit of Craftsman"(1-4) magazine.*


### Added new Farming Expands:

1. **Corn**: grows vanilla Corn.
2. **Peanuts**: grows vanilla Peanuts (will never be rotten).
3. **Wheat**: grows expaneded Wheat.
4. **Zucchini**: grows vanilla Zucchini.
5. **Pumpkin**: grows vanilla Pumpkin.
6. **Watermelon**: grows vanilla Watermelon
7. **Onion**: grows vanilla Onion
8. **Lettuce**: grows vanilla Lettuce
9. **Leek**: grows vanilla Leek
10. **Eggplant**: grows vanilla Eggplant
11. **Edamame**: grows vanilla Edamame
12. **Daikon**: grows vanilla Daikon
13. **PepperJalapeno**: grows vanilla PepperJalapeno
14. **PepperHabanero**: grows vanilla PepperHabanero
15. **BellPepper**: grows vanilla BellPepper

*no magazine required above*


### Added Magazine Expands:

1. **The Spirit of Craftsman Vol.1**: Teach `Craft Workbench`, `Craft Tongs`, `Craft Bellows`, `Quick make Charcoal`, `Self-made Glue`, `Self-made Wood Glue`, `Self-made Hairspray` and active `Make Metal Bar`, `Make Metal Pipe` which is hidden in vanilla;

2. **The Spirit of Craftsman Vol.2**: Teach `Craft Nails`, `Craft Paperclips`, `Craft Butter Knife`, `Craft Kitchen Knife`, `Craft Meat Cleaver`, `Craft Hand Scythe`, `Craft Hand Shovel`, `Craft Shovel`, `Craft Garden Hoe`, `Craft Pick Axe`, `Craft Crowbar`;

3. **The Spirit of Craftsman Vol.3**: Teach `Self-made White Paint`, `Self-made Red Paint`,`Self-made Blue Paint`, `Self-made Yellow Paint`, `Self-made Orange Paint`, `Self-made Purple Paint`, `Self-made Black Paint`, `Self-made Brown Paint`, `Self-made Cyan Paint`, `Self-made Green Paint`, `Self-made Gray Paint`, `Self-made Light Blue Paint`, `Self-made Light Brown Paint`,`Self-made Pink Paint`, `Self-made Turquoise Paint`;

4. **The Spirit of Craftsman Vol.4**: Teach `Craft Baseball Bat`, `Craft Nightstick`, `Craft Hunting Knife`, `Craft Machete`, `Craft Hand Axe`, `Craft Axe`, `Craft Wood Axe`;

5. **The Gospel Of Smoker**: Teach `Self-made Matches`, `Self-made Cigarettes`, `Self-made Newspaper Cigarettes`

*Recipes make weapones need to close Anvil, and required kind of weapone skill, ex. Craft Axe, required Axe skill as sample, also Maintenace skill will effect the Condition of you made, ex. Maintenace lv0, most result will be broken. And there is chance to damage sample item base on level of Maintenace.*

### Added Recipe Expands:

**General**

1. Self-made Matches `The Gospel Of Smoker`
2. Dismantle Notebook
3. Binding Notebook
4. Self-made Hairspray `The Spirit of Craftsman Vol.1`

**Health**

4. Self-made Cigarettes
5. Self-made Newspaper Cigarettes

**Carpentry**

6. Blend Concrete
7. Artifact Stone
8. Chipping Stone
9. Self-made Plaster Powder
10. Self-made Gravel Bag
11. Craft Empty Sack
12. Craft Rolling Pin
13. Craft Bowl
14. Craft Bellows
15. Craft Handle
16. Craft Baseball Bat `The Spirit of Craftsman Vol.4`
17. Craft Nightstick `The Spirit of Craftsman Vol.4`
18. Self-made Glue `The Spirit of Craftsman Vol.1`
19. Self-made Wood Glue `The Spirit of Craftsman Vol.1`

**Trapper**

20. Create Mouse Trap
21. Create Snare Trap

**Welding / Metalworking**

22. Smash Ingot: make Scrap Metal
23. Cut Barbed Wire
24. Craft Tongs `The Spirit of Craftsman Vol.1`
25. Craft Nails `The Spirit of Craftsman Vol.2`
26. Craft Paperclips `The Spirit of Craftsman Vol.2`
27. Craft Butter Knife `The Spirit of Craftsman Vol.2`
28. Craft Kitchen Knife `The Spirit of Craftsman Vol.2`
29. Craft Meat Cleaver `The Spirit of Craftsman Vol.2`
30. Craft Hunting Knife `The Spirit of Craftsman Vol.4`
31. Craft Machete `The Spirit of Craftsman Vol.4`
32. Craft Hand Axe `The Spirit of Craftsman Vol.4`
33. Craft Axe `The Spirit of Craftsman Vol.4`
34. Craft Wood Axe `The Spirit of Craftsman Vol.4`
35. Craft Pick Axe `The Spirit of Craftsman Vol.2`
36. Craft Hand Shovel `The Spirit of Craftsman Vol.2`
37. Craft Shovel `The Spirit of Craftsman Vol.2`
38. Craft Hand Scythe `The Spirit of Craftsman Vol.2`
39. Craft Garden Hoe `The Spirit of Craftsman Vol.2`
40. Craft Crowbar `The Spirit of Craftsman Vol.2`

**Survivalist**

41. Self-made Sling
42. Self-made Double Holster
43. Quick make Charcoal `The Spirit of Craftsman Vol.1`
44. Self-made Nuclear Biochemical Mask

**Painting**

43. Self-made White Paint `The Spirit of Craftsman Vol.3`
44. Self-made Red Paint `The Spirit of Craftsman Vol.3`
45. Self-made Blue Paint `The Spirit of Craftsman Vol.3`
46. Self-made Yellow Paint `The Spirit of Craftsman Vol.3`
47. Self-made Orange Paint `The Spirit of Craftsman Vol.3`
48. Self-made Purple Paint `The Spirit of Craftsman Vol.3`
49. Self-made Black Paint `The Spirit of Craftsman Vol.3`
50. Self-made Brown Paint `The Spirit of Craftsman Vol.3`
51. Self-made Cyan Paint `The Spirit of Craftsman Vol.3`
52. Self-made Green Paint `The Spirit of Craftsman Vol.3`
53. Self-made Gray Paint `The Spirit of Craftsman Vol.3`
54. Self-made Light Blue Paint `The Spirit of Craftsman Vol.3`
55. Self-made Light Brown Paint `The Spirit of Craftsman Vol.3`
56. Self-made Pink Paint `The Spirit of Craftsman Vol.3`
57. Self-made Turquoise Paint `The Spirit of Craftsman Vol.3`


**Cooking**

58. Open Box of Salt

### Allow chop meat to Minced Meat

`Rabbit Meat`, `Small Animal Meat`, `Small Bird Meat`, `Chicken`, `Mutton Chop`, `Pork Chop`, `Steak`

Also allow chop pickled meat into Pickled Minced Meat, after few days it turn to Mysterious Meat.


### Allow put more Foods in Jar

`Rabbit Meat`, `Small Animal Meat`, `Small Bird Meat`, `Fish Fillet`, `Fish Roe`, `Salmon`, `Shrimp`, `Chicken`, `Egg`, `Frog Meat`, `Minced Meat`, `Mutton Chop`, `Pork Chop`, `Steak`, `Apple`, `Orange`, `Peach`, `Pear`, `Pineapple`, 

### Allow pickle meat

`Rabbit Meat`, `Small Animal Meat`, `Small Bird Meat`, `Fish Fillet`, `Salmon`, `Shrimp`, `Chicken`, `Frog Meat`, `Minced Meat`, `Mutton Chop`, `Pork Chop`, `Steak`,

use salt to make **Pickled** meat, after few days, it will turn to **Dehydrated** meat, it is not go bad any way.

Pickle meat before it's goes to rotten. unlike jar, pickle food can working on any size of meat. big meat produce big dehydrated.

### New food recipes

`Make Tofu`, `Make Mixed Vegetables`


## Ammo Maker

You can make Gunpowder and Bullets, but you have to read the Magginze first.
But, get materials still is not that easy.

Also ammo box contains is 50% increased. (Weight and MetalValue as well)

DO NOT waste bullets anyaway.


### Added Magazine Expands:

1. **The Spring Of Musketeer**: Teach `Craft Gunpowder`, `Craft 9mm Bullets`, `Craft .223 Bullets`, `Craft .308 Bullets`, `Craft Shotgun Shells`, `Craft 5.56mm Bullets`, `Craft .38 Special Bullets`, `Craft .44 Magnum Bullets`, `Craft .45 Auto Bullets`

### Vanilla Overrides:

1. **Gather Gunpowder**: After calculation gunpowder uses when make bullets. It will effect by `Perks.Reloading`. 


### Added Items Expands:

1. 556BulletsMold
2. 38SpecialBulletsMold
3. 44MagnumBulletsMold
4. 45AutoBulletsMold

*other bullets mold already exists in vanilla, also you CAN NOT make bullet mold.the only way to get mold is search and loot. ex. gun store, amry crate. high possibility with survivalist stuff.*

### Added Recipe Expands:

1. Craft Gunpowder
2. Craft 9mm Bullets
3. Craft Shotgun Shells
4. Craft .308 Bullets
5. Craft .223 Bullets
6. Craft 5.56mm Bullets
7. Craft .38 Special Bullets
8. Craft .44 Magnum Bullets
9. Craft .45 Auto Bullets

*All recipe is required read "The Spring Of Musketeer"*

**Require near by Stone Furnace or Campfire, also fire must be lit up.**


## Weapons / Tools

Combine with other crossbow models. have several of corssbows. also need a magazine to learn recipes.
and modified some Vanilla Weapons or tools.

### Add Crossbow and Components

1. **CrossbowHand**: Prophecy Pistol Hand Crossbow.
2. **CrossbowCompound**: Haze 470 Compound Bow.
3. **CrossbowWooden**: Handmade Wooden Crossbow.
4. **CrossbowBolt**: Crossbow Bolt.
5. **CrossbowBoltBox**: Bundle of Crossbow Bolts.
6. **CrossbowBoltBroken**: Broken Crossbow Bolt (chance to break the bolt while hit the target).
7. **CrossbowMakerMag**ï¼šDoomsday Preppers, Teach `Craft Wooden Crossbow`, `Craft Crossbow Bolts`

## Modified Vanilla Items

**Better Wrenchs**: `PipeWrench`, `Wrench`, increase harder and powered.
**Harder Pans**: `Pan`, `GridlePan`, `Saucepan` not that easy to broken.
**Better Hammers**: `Hammer`, `BallPeenHammer`, make hammer like real hammer.
**Harder Axe Stone**: `AxeStone` like a Axe, not Tofu.
**Bigger PropaneTank**: `PropaneTank` double the useDelta.

All changes are balanced with a vanilla game.



## Skill Books

Add skill book for Perk `Aiming` and `Reloading`.

`BookWeaponAiming1`, `BookWeaponAiming2`, `BookWeaponAiming3` are for Aiming Perk,
can boost by skill book between lv1 ~ lv6

`BookWeaponReloading`, is for Reloading Perk, only up to lv2.


## Traits Modify

Trait `Handy` add `Perks.SmallBlunt` + 1, make -8 practical use.
Pertty much like `Hunter`.


## Cure

A Mysterious Serum Injection drop by `HazardSuit` or somewhere in Medical place, especially from amry.
Looting change is round about 25%, effect by `Lucky` or `Unlucky` Traits.
(tested kill 50 HazardSuit zombie in Debug mode, got 4 injection. without Lucky traits)

*Mysterious Serum Injection* take chances to cure the infection. (set by sandbox options)
`Lucky` increase 50% (75% total chance to cure, if default setting)
`Unlucky` decrease 25% (25% total chance to cure, if default setting)

More bad player stats will showing up when cured.
there is chance to be fake cured base on CureChance option in MOD sandbox settings.

If eat it with out infection, that will be waste, and bad stats will come up too.


## Survival Journal

Player can Write A Survival Journal, it will store current Level for Perks, mostly.
when player character dead, new character can read this Journal to help restore Perks.
No XP added directly, only huge multipair of Skills, that make level up very quick.

## Silencers

Some firearm can attach Silencer, work with or without Screwdriver.

There is Silencer for Pistol and Rifle, also can craft hand-made silencers, but not for every firearms. 
Silencers is on Base package, incase some other MOD need it.


## TV Tap

A New Tv Tap `First Aid Guide 1 - 4` for gain `FristAid` Perk.

## Exercises

Combine Exercises, Bench Press and Treadmill. Those exercises, is work like Vanilla Exercises exactly.
Character must be near by the device to start exercise, also Treadmill need electricity.
 

## Better Shoes

Combine better shoes models.


## Drink Packs

Combine Drink packs. pack up 6 or 12 Bottle or Pop Can into one.


## Fishing Net

Make better Fishing Net, could cacth more than `BaitFish`, base on character fishing skill and lucky.

## Training

All training action will not pause the game when training is stopped. Did it on purpose, decide to keep eyes open.
To activate training action by click on the context menu. etc, right click clothing, or right click vehicle.

**Tailoring**: just like others MOD `AutoSewing`, but mine is totally base on TimedAction not dirty override or hooking.
it will random choose part of clothing, remove patch if have one, add path it if available whatever is have hole or not.
*only FabricType is "Cotton" can use for training.*

**Mechanics**: just like others MOD `AutoMechanics`, but mine is totally base on TimedAction no override and hooking,
and most important is, mine is choose to uninstall and install each part once at time, 
also it will skip parts which is beyond player's current perk level.
you have to learn recipe for each type of cars, and car doors should not be locked.


## Cigarettes

Cigarettes Pack for 20 Cigarettes. all distribution decide chance to make `CigarettesPack` to replace `Cigarettes`.
Cigarettes Pack can refill with numbers of Cigarettes. When smoke with Cigarettes Pack, 1 Cigarettes will draw out and smoking.


## GunSuicide

Kill your self by a loaded gun, prevent become a zombie.














# For Develpers 


## ClothingItem Tips

`<m_MaleModel>`, `<m_FemaleModel>` path to 3D model file, X or fbx, X is too old, so use fbx.
DO NOT just convert X to fbx, if skinned info will be lost, model will not working anymore.

`<m_GUID>` the guid for thi item, must add to fileGuidTable.xml from `media` folder,
otherwise item will not found. Use same GUID to ovrride the others.

`<m_AllowRandomHue>true</m_AllowRandomHue>` change the color of texture base on Hue.
`<m_AllowRandomTint>true</m_AllowRandomTint>` tint the texture, so light texuture will be nice. 
dark texture also work, but most time tint to more darkness.

`<m_AttachBone></m_AttachBone>`  attach bone info. I don't know how to use it yet.

`<m_Masks>11</m_Masks>` the number id of the body part will be masked. (0-15) any other numbers will crash the game.

`<m_MasksFolder></m_MasksFolder>` mask folder, but I dont know how effect the results yet.

`<m_UnderlayMasksFolder>fancyshoes</m_UnderlayMasksFolder>` underlay mask folder, for closthes with model.

`<textureChoices>` the path to texture file, must be png, no need file ext. path startswith textures folder.

`<m_BaseTextures>` it is for body base, which mean is for none model closthes, I guess.
**<m_BaseTextures>clothes\gloves\leathergloves_brown</m_BaseTextures>**

*Example here*

```
<clothingItem>
    <m_MaleModel>media\models_X\Static\Clothes\fancyshoes_male.fbx</m_MaleModel>
    <m_FemaleModel>media\models_X\Static\Clothes\fancyshoes_female.fbx</m_FemaleModel>
    <m_GUID>b87c05cc-9a93-4572-99f8-005e350ee723</m_GUID>
    <m_Static>false</m_Static>
    <m_AllowRandomHue>true</m_AllowRandomHue>
    <m_AllowRandomTint>true</m_AllowRandomTint>
    <m_AttachBone></m_AttachBone>
    <m_Masks>11</m_Masks>
    <m_MasksFolder></m_MasksFolder>
    <m_UnderlayMasksFolder>media/textures/Clothes/Shoes/Masks/fancyshoes</m_UnderlayMasksFolder>
    <textureChoices>clothes/Shoes/shoes_white</textureChoices>
    <textureChoices>clothes/Shoes/shoes_brown</textureChoices>
    <textureChoices>clothes/Shoes/shoes_red</textureChoices>
    <textureChoices>clothes/Shoes/shoes_pale</textureChoices>
    <textureChoices>clothes/Shoes/shoes_pink</textureChoices>
</clothingItem>
```

*KEEP IN MIND*

`<m_Masks>` is taken orders. For example, if a `Shoes` item set `m_Makes` to 11, `Skirt` will be show strange buggey.
because `Skirt` have a port in 11, and `Skirt` rendering before `Shoes`,
`Shoes`'s Underlay Maskswill not only mask itself, but other underlays.


very important is the if Ovrride Vanilla ClothingItems, IT MUST place intro `fileGuidTable.xml`.
otherwise not fully work, might change texture or masks will change someting, but not really, the model still wrong.


I guess this is sort of hacking, shoes not really cover the mask 11, 
but use this to trigger underlaymask to work.
to do this, MUST ovrride BodyLoaction.lua, put `Shoes` before `Jacket` or `Skirt` something.
otherwise will brake the mash when waring Jacket with Skirt. 
(see what happend by image somewhere in this project, proprobably in _assets folder)
BUT, this is not good idea to ovrride this way.
other mod might do samething, than cause conflict.
WHY do this? because for the hightheels with foot instep showing up.
MUST trigger the underlayMaks to work, might need use one of mask.
CAN NOT use mask 8 and 10, that will masking both feet.
But If no mask, the highheel wont showing up.
only mask 11 will not mask any body part, but it will effect other clothes with model.
etc. `Jacket` or `Skirt`... that why need put `Shoes` before others in BodyLocation.
that's hacking way, might cause other problem don't know yet.

```
<m_Masks>11</m_Masks>
<m_UnderlayMasksFolder>media/textures/Clothes/Shoes/Masks/fancy_shoes</m_UnderlayMasksFolder>
```


`<m_UnderlayMasksFolder>` seems only work when `m_masks` setted.


## 3D Model with animation

### Models_X

Seems folders id dosn't really matter.
different folder for easy to separate different models.

**Skinned/**: for hair, clothing, include bags. models must have skinned info.
**Static/**: for gears or shoes.
**Weapons/**: for weapons.
**Worlditems/**: for Items when drop on the floor.
*others can custom folder*

Define models with *clothingItem*, only have to give right path to the model file.
both male or female, model file could be same. `/` or `\` seems dosn't matter. 
path starts from *media/models_x*. also no matter uppercase or not.
```
<clothingItem>
    <m_MaleModel>skinned\clothes\bob_hazmat</m_MaleModel>
    <m_FemaleModel>skinned\clothes\kate_hazmat</m_FemaleModel>
    <m_GUID>c8e9ccd6-1a04-4211-a604-4e82e627cc0f</m_GUID>
    <m_Static>false</m_Static>
    <m_AllowRandomHue>false</m_AllowRandomHue>
    <m_AllowRandomTint>false</m_AllowRandomTint>
    <m_AttachBone></m_AttachBone>
    <m_MasksFolder></m_MasksFolder>
    <textureChoices>clothes/ArmorPads/ElbowPads</textureChoices>
</clothingItem>
```

Define models by `<name>_models` in scripts.
`model <Name> {...}` for static model. name better to Capitalized.
`model <Name>_Ground {...}` for Worlditems model. name better to Capitalized.

in `<name>_items` scripts, `StaticModel = ` is for the item self, `WorldStaticModel = ` is for item when drop on floor (Worlditems),

there is no need write theme in separate script file, could be same one.

for the block of **model**:

`mesh =` is the path of model file, starts from *media/models_x*, better to use fbx. 
`texture` is path for texture, starts from *media/texutre*
*in mesh = <model_file_name_>|<object_name>, No need use `|` if export by selected Object from blender. this is use to separate multiple different object in same .fbx files*

*for example:*

```
model Canteen {
    mesh = Static/Gear/canteen,
    texture = Gear/canteen,
    attachment world
    {
        offset = 0.0000 0.0000 0.0000,
        rotate = 180.0000 0.0000 0.0000,
    }
}

item Canteen {
    Weight = 0.1,
    CanStoreWater =TRUE,
    Type = Normal,
    DisplayName = Canteen,
    ReplaceOnUseOn = WaterSource-Canteenfull,
    icon = Canteen,
    RainFactor = 1,
    Tooltip = Tooltip_item_RainFromGround,
    
    AttachmentType = Canteen,

    StaticModel = Canteen,
    WorldStaticModel = Canteen_Ground,
}
```

### anims_X and AnimSets

3D model files in place in **anims_X**, It could be DirectX (.X) file or fbx. 
no matter folder or file name, no file path need too.

the `anims_X` or `animSets` name is defined in the file. engine will loaded all files,
and put in some stack, use theme must by name defined in those files.

the .X file seems could use txt format, that mean you can edit by text editor, if you understand what are you doing.
no matter the .X file name, in the file have a attribute `AnimationSet <name>`, this name is used for `<m_AnimName>` in **AnimSets**

```
AnimationSet SOMETHINE_Idle {...}
```

for .fbx, seems the animationSet name is set by `Action Strip` name (the one one the timeline of `NLATracks`),
in `Nolinear Animation` Panel (which is switch by little button top left of current panel)
in the timeline of NLATracks, right click and rename it. 
if no NLATrack exsit, try select the animate action you want than click on the menu `Add -> Add Tracks`.

when export set the transform to `-Z forward / Y up` and armature primary bone `X aixs`, secondary bone `Y aixs`.
sometime the exported model is messup, try reverse the those options, might be problem may solved.

*better to learn more about blender anyway.*

the etc. `Dummy01|BenchIn`
*import a fbx anims_x file to blender, you will see the animation node.*
*Looks like zombiod engine will load all 3dModel in anims_x folder, whatever what is it. than place it in same stack, find it by animationSet name when use it.*

For `AnimSets` file, see a example of Fitness Exercises with Treadmill.

*file: Treadmill.xml*
```
<?xml version="1.0" encoding="utf-8"?>
<animNode>
    <m_Name>treadmill</m_Name>
    <m_AnimName>Exercises_Run</m_AnimName>
    <m_deferredBoneAxis>Z</m_deferredBoneAxis>
    <m_SyncTrackingEnabled>false</m_SyncTrackingEnabled>
    <m_SpeedScale>1.00</m_SpeedScale>
    <m_BlendTime>0.40</m_BlendTime>
    <m_Conditions>
        <m_Name>ExerciseType</m_Name>
        <m_Type>STRING</m_Type>
        <m_StringValue>treadmill</m_StringValue>
    </m_Conditions>

    <m_SubStateBoneWeights>
        <boneName>Dummy01</boneName>
    </m_SubStateBoneWeights>
    <m_SubStateBoneWeights>
        <boneName>Translation_Data</boneName>
    </m_SubStateBoneWeights>
</animNode>
```

`<m_Name>treadmill</m_Name>`: is the animation set name, it is trigger by `<m_Conditions>`, see this:
```
<m_Conditions>
    <m_Name>ExerciseType</m_Name>
    <m_Type>STRING</m_Type>
    <m_StringValue>treadmill</m_StringValue>
</m_Conditions>
```
*When set player's ExerciseType == 'treadmill' (in lua or java), this animation will be trigger.*
*<m_Name> will also use to <m_Transitions>, explain later.*

`<m_AnimName>Exercises_Run</m_AnimName>`: the anims_X name used for this animation,
remember is not file name, is the `AnimationSet <name>` for .X file. is `Action Strip` name for .fbx.


*file: TreadmillOut.xml, play when leave the treadmill*
```
<?xml version="1.0" encoding="utf-8"?>
<animNode x_extends="Treadmill.xml">
    <m_Name>treadmillout</m_Name>
    <m_AnimName>Exercises_Run</m_AnimName>
    <m_Looped>false</m_Looped>
    <m_Conditions />
    <m_Conditions>
        <m_Name>ExerciseEnded</m_Name>
        <m_Type>BOOL</m_Type>
        <m_BoolValue>true</m_BoolValue>
    </m_Conditions>
    <m_Events>
        <m_EventName>SetVariable</m_EventName>
        <m_Time>End</m_Time>
        <m_ParameterValue>FitnessFinished=TRUE</m_ParameterValue>
    </m_Events>
</animNode>
```

`<m_Name>treadmillout</m_Name>`: the name here is animation set name too,
this animation is trigger by `<m_Conditions>` too, see this:

```
<m_Conditions>
    <m_Name>ExerciseEnded</m_Name>
    <m_Type>BOOL</m_Type>
    <m_BoolValue>true</m_BoolValue>
</m_Conditions>
```

*When ExerciseEnded (toggle by lua or java somewhere), this animation will play.*

**but why there not ExerciseType, how come to know that's end of treadmill? see this:**
`<animNode x_extends="Treadmill.xml">` that mean is this xml is extands from `Treadmill.xml`, the ExerciseType is defined there.

the animation goes to `Treadmill.xml` first, then conditions change and match with the on in TreadmillOut.xml.
that's how animation works, I guess.


folders in the **AnimSets**, is really matter. those folder is defined by game as default.
It is separate folders for different character events. seems you won't easy to create new one.
those events is trigger by many other ways, such as player state and conditions. etc. `climbSheetRope`.

for equipable items, might set by `ReplaceInPrimaryHand = <clothingItem> <animtionset name>, `
like this
```
ReplaceInPrimaryHand = none holdingbikeright, /* no clothingItem need, just give nothing. */
```

`holdingbikeright` is anim set name.
the clotingItem is replace by none here, because there is no need clothingItem.

if need, just give a clothingItem name, and set model and texture in the clothingItem file.
just like all the bags from vanilla.


**No need to restart the game, when animSets is chagned, the game will reload it (few seconds later). but better restart game when delete or add xml (or x_extends= is changed) for animSets, incace strange happen.**

when game want animation will go to folders in **AnimSets** to find one matched.
**Different type animation will go different folder first**
after that, will find first one match all conditions will be play.

*like this: in idle folder*
```
<animNode>
    <m_Name>idle_Swim</m_Name>
    <m_AnimName>SwimIdle</m_AnimName>
    <m_Conditions>
        <m_Name>isSwimming</m_Name>
        <m_Type>BOOL</m_Type>
        <m_BoolValue>true</m_BoolValue>
    </m_Conditions>
    <m_Conditions>
        <m_Name>isMoving</m_Name>
        <m_Type>BOOL</m_Type>
        <m_BoolValue>false</m_BoolValue>
    </m_Conditions>
</animNode>
```
first player character must be idle, that mean go idle folder find one animation.
condition must be `isMoving=false` and `isSwimming=true`.

```
<animNode>
    <m_Name>idle_Swim</m_Name>
    <m_AnimName>SwimIdle</m_AnimName>
    <m_Conditions>
        <m_Name>isSwimming</m_Name>
        <m_Type>BOOL</m_Type>
        <m_BoolValue>true</m_BoolValue>
    </m_Conditions>
</animNode>
```

if not condition of `isMoving`, seems play as well.
because it is idle state, character is not moving anyway.
but if the animation might have little bit gap.
Also if no Condition `isSwimming` will conflict with default `Idle`.
may not play or cause other problems.

*becareful with state.*


#### Transitions (guess)

Defined how to transition between current animation to target animation.
its no effect which animation should be play with state.
only the transition.

which state animation to go is driver by game engine.

```
<m_Transitions>
    <m_Target>defaultRun</m_Target>
    <m_AnimName>Bob_Run</m_AnimName>
    <m_blendInTime>0.3</m_blendInTime>
    <m_blendOutTime>0.3</m_blendOutTime>
</m_Transitions>
```

`<m_Target>` is the anim set name, not file name.
`<m_AnimName>` the animtion playing while transition. no animation play if not give this option.
`<m_blendInTime>` and `<m_blendOutTime>` is the time of transition animation.




## Strange Errors


### Recipe Format is wrong

if got `ISCraftingUI` exceptions, probably is Recipe Script is wrong, might missing `,` end of some line.

```
-----------------------------------------
function: populateRecipesList -- file: ISCraftingUI.lua line # 1093 | Vanilla
function: createChildren -- file: ISCraftingUI.lua line # 969 | Vanilla
function: instantiate -- file: ISUIElement.lua line # 653 | Vanilla
function: addToUIManager -- file: ISUIElement.lua line # 1009 | Vanilla
function: createInventoryInterface -- file: ISPlayerDataObject.lua line # 157 | Vanilla
function: createInventoryInterface -- file: ISPlayerDataTuning.lua line # 22 | MOD: Tsar's Common Library v.2.07
function: createPlayerData -- file: ISPlayerData.lua line # 187 | Vanilla.
[28-02-24 23:29:29.090] ERROR: General     , 1709134169090> ExceptionLogger.logException> Exception thrown java.lang.RuntimeException: attempted index: getFullType of non-table: null at KahluaThread.tableget line:1689..
[28-02-24 23:29:29.090] ERROR: General     , 1709134169090> DebugLogStream.printException> Stack trace:.
[28-02-24 23:29:29.092] LOG  : General     , 1709134169092> -----------------------------------------
```


### No math.round()

use math.floor(n + 0.5) to make round().
lua sucks.



### MOD Sandbox options wrong cause Game Crash when Boot

Only got Unhandled Exception, that usual mean is MOD is block starting.

```
[03-03-24 16:21:08.955] LOG  : Clothing    , 1709454068955> mod "RAVENCRAFT" overrides female outfit "Biker".
[03-03-24 16:21:08.955] LOG  : Clothing    , 1709454068955> mod "RAVENCRAFT" overrides female outfit "Classy".
[03-03-24 16:21:08.955] LOG  : Clothing    , 1709454068955> mod "RAVENCRAFT" overrides female outfit "Party".
[03-03-24 16:21:09.873] LOG  : Lua         , 1709454069873> Loading: media/lua/shared/Sandbox/Apocalypse.lua.
[03-03-24 16:21:10.038] ERROR: General     , 1709454070038> GameWindow.uncaughtException> Unhandled java.lang.RuntimeException thrown by thread MainThread..
[03-03-24 16:21:10.039] ERROR: General     , 1709454070039> ExceptionLogger.logException> Exception thrown java.lang.RuntimeException: java.lang.IllegalArgumentException at GameWindow.mainThreadInit line:580. Message: Unhandled java.lang.RuntimeException thrown by thread MainThread..
[03-03-24 16:21:10.039] ERROR: General     , 1709454070039> DebugLogStream.printException> Stack trace:.
[03-03-24 16:21:10.040] LOG  : General     , 1709454070040> GameThread exited..
```

at last checkout the sandbox options. default is large than max. that's problmen cause crash.
```
option RavenCraft.SurvivalJournalMultiplierModifier{
    type = integer, min = 1, max = 12, default = 20,
}
```



## Generator UI window buggey

*This problem is not related with this mod.*
windows in Vanilla game might buggey, like generator info window.
go `zomboid` folder which contain `save` folder,
in `zomboid/lua/layout.ini` could fix that. just change the size.
```
ISSearchWindow x=120 y=300 visible=false pin=true width=300 height=180
charinfowindow x=1274 y=104 visible=false pin=true tabs=info,skills,health,clothingIns,protection current=info
inventory0 x=322 y=0 width=640 height=360 visible=true pin=false column2=240 sortBy=nameInc
loot0 x=964 y=0 width=662 height=360 visible=true pin=false column2=321 sortBy=catDesc
crafting0 x=1042 y=412 width=878 height=606 visible=false pin=true
mechanics0 x=1120 y=181 width=800 height=600 visible=false pin=true
miniMap0 x=1720 y=866 visible=true userPosition=true
survivalguide visible=false
furnace x=395 y=94 visible=true pin=true width=394 height=178
radiotelevisionIso x=1361 y=382 visible=false pin=true width=300 height=337
generator x=70 y=50 visible=true pin=true width=240 height=121
farming x=1305 y=112 visible=false pin=true width=254 height=210
literature x=136 y=21 width=400 height=980 visible=true pin=true
```


## AddItem with Count in script

In Vanilla, recipe with Cigarettes = 20, will cause result x20 (800),
but Cigarettes=1 will only get 1. thats because item `Cigarettes` is count 20,
when use AddItems /AddItem with String type name will effect by the count. I guess.
```
   (in DOCS https://pzwiki.net/wiki/Scripts_guide/Item_Script_Parameters/Count)
   Count:
   Determines how many items of this type will appear when spawning/crafting this type of item.
```
try DO NOT override the item script `Count`, otherwise will effect numbers when distribution.

```
function Recipe.OnCreate.OpenCigarettesPack(items, result, player)
   if result:getFullType() == "Base.Cigarettes" then
        for i=0, items:size() -1 do
            local item = items:get(i)
            if item:getType() == 'CigarettesPack' then
                -- In Recipoe `Result: Cigarettes,`
                -- result have only 1 Cigarettes

                -- AddItem or AddItems with String name will trigger the `Count`
                -- player:getInventory():AddItem("Base.Cigarettes")
                -- -- addItem for Cigarettes, now will be 21,
                -- player:getInventory():RemoveOneOf("Base.Cigarettes")
                -- -- remove one of it, now will be 20.

                local count = math.floor(item:getUsedDelta() / item:getUseDelta() + 0.5)
                for j=1, count - 1 do -- remember recipe will create one.
                    local cigarettes = InventoryItemFactory.CreateItem("Base.Cigarettes")
                    -- AddItem with InventoryItem will be fine.  AddItems will not
                    player:getInventory():AddItem(cigarettes)
                end
            end
        end
   end
end
```


## Modelling with Blender

export `.fbx` file for now. `X` is too old.
if make **Static** model, like shoes / mask/ hat, can bind bone in **ClothingItem** or make to skinned bind in model both work.
if make skinned model might use the template with bone from `_assets/`.

when export Staic model to `.fbx`, should take care of the **Transform** settings *Up* and *Forward*.
Can also just move or rotate the model to right position in model, and leave the default settings and export.
try not select **Armature** and **Bake Animation**. not sure what happen, maybe nothing.

*Becareful the size of model*. most time the model in game is really small, must set scale to very small in export settings. etc. `0.01`
but could be any size when modeling, bigger enough too operate.



## TimedAction


### isValidStart only trigger when after another action completed.

`perform` must before the `eatItem`, because in `ISEatFoodAction` have `isValidStart()`
it will check MoodleLevel of Eaten, when character is too full, will stop the queue,
but `isValidStart()` only trigger when a queue action onComplete, it's not trigger by first action.

** in `ISEatFoodAction` **
```
function ISEatFoodAction:isValidStart()
    return self.character:getMoodles():getMoodleLevel(MoodleType.FoodEaten) < 3 or self.character:getNutrition():getCalories() < 1000
end
```
** in `ISTimedActionQueue` **
```
function ISTimedActionQueue:onCompleted(action)
    self:removeFromQueue(action)

    self.current = self.queue[1]

    if self.current then
        if self.current:isValidStart() then
            self.current:begin()
        else
            print('bugged action, cleared queue ', self.current.Type or "???")
            self:resetQueue()
            return
        end
    end
end
```


# Timed Actions

if character wear item instantly, check the cheat menu, `Timed Action instant` might be turned ON.
